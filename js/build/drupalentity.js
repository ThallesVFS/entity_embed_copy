!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.drupalentity=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/widget.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";r.d(i,{default:()=>l});var e=r("ckeditor5/src/core.js"),t=r("ckeditor5/src/widget.js");class n extends e.Command{execute(e){const{model:t}=this.editor,r=this.editor.plugins.get("EntityEmbedEditing"),i=Object.entries(r.attrs).reduce(((e,[t,r])=>(e[r]=t,e)),{}),n=Object.keys(e).reduce(((t,r)=>(i[r]&&(t[i[r]]=e[r]),t)),{});t.change((e=>{t.insertContent(function(e,t){return e.createElement("drupalEntity",t)}(e,n))}))}}class a extends e.Plugin{static get requires(){return[t.Widget]}init(){this.attrs={alt:"alt",title:"title",dataCaption:"data-caption",dataAlign:"data-align",drupalEntityLangCode:"data-langcode",drupalEntityEntityType:"data-entity-type",drupalEntityEntityUuid:"data-entity-uuid",drupalEntityEmbedButton:"data-embed-button",drupalEntityEmbedDisplay:"data-entity-embed-display",drupalEntityEmbedDisplaySettings:"data-entity-embed-display-settings"};const e=this.editor.config.get("entityEmbed");e&&(this.options=e,this.labelError=Drupal.t("Preview failed"),this.previewError=`\n      <p>${Drupal.t("An error occurred while trying to preview the embedded content. Please save your work and reload this page.")}<p>\n    `,this._defineSchema(),this._defineConverters(),this.editor.commands.add("drupalentity",new n(this.editor)))}_defineSchema(){this.editor.model.schema.register("drupalEntity",{isObject:!0,isContent:!0,isBlock:!0,allowWhere:"$block",allowAttributes:Object.keys(this.attrs)}),this.editor.editing.view.domConverter.blockElements.push("drupal-entity")}_defineConverters(){const{conversion:e}=this.editor;e.for("upcast").elementToElement({model:"drupalEntity",view:{name:"drupal-entity"}}),e.for("dataDowncast").elementToElement({model:"drupalEntity",view:{name:"drupal-entity"}}),e.for("editingDowncast").elementToElement({model:"drupalEntity",view:(e,{writer:r})=>{const i=r.createContainerElement("figure",{class:"drupal-entity"});return r.setCustomProperty("drupalEntity",!0,i),(0,t.toWidget)(i,r,{label:Drupal.t("Entity Embed widget")})}}).add((e=>(e.on("attribute:drupalEntityEntityUuid:drupalEntity",((e,t,r)=>{const i=r.writer,n=t.item,a=r.mapper.toViewElement(t.item);let d=this._getPreviewContainer(a.getChildren());if(d){if("ready"!==d.getAttribute("data-drupal-entity-preview"))return;i.setAttribute("data-drupal-entity-preview","loading",d)}else d=i.createRawElement("div",{"data-drupal-entity-preview":"loading"}),i.insert(i.createPositionAt(a,0),d);this._loadPreview(n).then((({label:e,preview:t})=>{d&&this.editor.editing.view.change((r=>{const i=r.createRawElement("div",{"data-drupal-entity-preview":"ready","aria-label":e},(e=>{e.innerHTML=t}));r.insert(r.createPositionBefore(d),i),r.remove(d)}))}))})),e))),Object.keys(this.attrs).forEach((t=>{const r={model:{key:t,name:"drupalEntity"},view:{name:"drupal-entity",key:this.attrs[t]}};e.for("dataDowncast").attributeToAttribute(r),e.for("upcast").attributeToAttribute(r)}))}async _loadPreview(e){const t={text:this._renderElement(e)},r=await fetch(Drupal.url("embed/preview/"+this.options.format+"?"+new URLSearchParams(t)),{headers:{"X-Drupal-EmbedPreview-CSRF-Token":this.options.previewCsrfToken}});if(r.ok){return{label:Drupal.t("Entity Embed widget"),preview:await r.text()}}return{label:this.labelError,preview:this.previewError}}_renderElement(e){const t=this.editor.model.change((t=>{const r=t.createDocumentFragment(),i=t.cloneElement(e,!1);return t.append(i,r),r}));return this.editor.data.stringify(t)}_getPreviewContainer(e){for(const t of e){if(t.hasAttribute("data-drupal-entity-preview"))return t;if(t.childCount){const e=this._getPreviewContainer(t.getChildren());if(e)return e}}return null}static get pluginName(){return"EntityEmbedEditing"}}var d=r("ckeditor5/src/ui.js");class o extends e.Plugin{init(){const e=this.editor,t=e.commands.get("drupalentity"),r=e.config.get("entityEmbed");if(!r)return;const{dialogSettings:i={}}=r,n=r.buttons;Object.keys(n).forEach((a=>{let o=Drupal.url("entity-embed/dialog/"+r.format+"/"+a);e.ui.componentFactory.add(a,(r=>{let s=n[a],l=new d.ButtonView(r);return l.set({label:s.label,icon:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">  <image id="image0" width="16" height="16" x="0" y="0"\n    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAALGPC/xhBQAAAAJiS0dE\nAP+Hj8y/AAAAB3RJTUUH5gkNAywZrK+VpAAAAElJREFUKM9jYKAeuMrwHwUuhwizoCj6xfALzv6J\nzYRKTIOZCNmMaoUpQzKcvZnhFX5HWmIz4SrDDTj7LbUcSVABbkfeJ9kEcgEApvsllE2X4VkAAAAl\ndEVYdGRhdGU6Y3JlYXRlADIwMjItMDktMTNUMDE6NDQ6MjUrMDI6MDCMUacyAAAAJXRFWHRkYXRl\nOm1vZGlmeQAyMDIyLTA5LTEzVDAxOjQ0OjI1KzAyOjAw/QwfjgAAAABJRU5ErkJggg==" />\n</svg>\n',tooltip:!0}),l.bind("isOn","isEnabled").to(t,"value","isEnabled"),this.listenTo(l,"execute",(()=>Drupal.ckeditor5.openDialog(o,(({attributes:t})=>{e.execute("drupalentity",t)}),i))),l}))}))}}class s extends e.Plugin{static get requires(){return[a,o]}static get pluginName(){return"EntityEmbed"}}const l={EntityEmbed:s}})(),i=i.default})()));